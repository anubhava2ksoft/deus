<?xml version="1.0" encoding="UTF-8"?>
<aut:automator
	xmlns:aut="http://dsg.ce.unipr.it/software/deus/schema/automator"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://dsg.ce.unipr.it/software/deus/schema/automator ../../schema/automator.xsd ">


	<!-- *** EVENTS *** -->

	<aut:event id="birth" handler="it.unipr.ce.dsg.deus.example.chord.ChordBirthEvent" 
		schedulerListener="it.unipr.ce.dsg.deus.example.chord.ChordBirthSchedulerListener" >
	 	<aut:events><!-- events to be scheduled on created node -->
		    <aut:reference id="join" />
		    <aut:reference id="publish" />
		    <aut:reference id="stabilize" />
		    <aut:reference id="fixFingers" />	
		    <aut:reference id="refresh" />	  
		    <aut:reference id="discovery" />
		</aut:events>
	</aut:event>

	<aut:event id="join" handler="it.unipr.ce.dsg.deus.example.chord.ChordJoinEvent" oneShot="true" />

	<aut:event id="publish" handler="it.unipr.ce.dsg.deus.example.chord.ChordPublishEvent" oneShot="true" />

	<aut:event id="discovery" handler="it.unipr.ce.dsg.deus.example.chord.ChordDiscoveryEvent" oneShot="true" />

	<aut:event id="death" handler="it.unipr.ce.dsg.deus.example.chord.ChordDeathEvent" oneShot="true"/>
	
	<aut:event id="disconnection" handler="it.unipr.ce.dsg.deus.example.chord.ChordDisconnectionEvent" />

	<aut:event id="refresh" handler="it.unipr.ce.dsg.deus.example.chord.ChordRefreshPublishEvent" >
		<aut:logger level="OFF" />
			<aut:params>
			<aut:param name="hasSameAssociatedNode" value="true" />
		</aut:params>
	</aut:event>

	<aut:event id="stabilize" handler="it.unipr.ce.dsg.deus.example.chord.ChordStabilizeEvent">
		<aut:params>
			<aut:param name="hasSameAssociatedNode" value="true" />
		</aut:params>
	</aut:event>

	<aut:event id="fixFingers" handler="it.unipr.ce.dsg.deus.example.chord.ChordFixFingersEvent">
		<aut:params>
			<aut:param name="hasSameAssociatedNode" value="true" />
		</aut:params>
	</aut:event>

	
	<aut:event id="logPopulationSize" handler="it.unipr.ce.dsg.deus.impl.event.LogPopulationSizeEvent" />
	
	<aut:event id="logChordRingStats" handler="it.unipr.ce.dsg.deus.example.chord.LogChordRingStatsEvent" />
	
	<aut:event id="logChordForPajek" handler="it.unipr.ce.dsg.deus.example.chord.LogChordForPajekEvent" />
	
	<aut:event id="logChordForNWB" handler="it.unipr.ce.dsg.deus.example.chord.LogChordForNwbEvent" />
	
	<aut:event id="time" handler="it.unipr.ce.dsg.deus.example.chord.LogChordTime" />
	
	<aut:event id="logChordLoadBalance" handler="it.unipr.ce.dsg.deus.example.chord.LogChordLoadBalance" />
	
	<!-- *** NODE SPECIES *** -->

	<aut:node id="chordPeer" handler="it.unipr.ce.dsg.deus.example.chord.ChordPeer">
		<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="fingerTableSize" value="14" />
			<aut:param name="resourcesNode" value="10" />
		</aut:params>
	</aut:node>


	<!-- *** PROCESSES *** -->

	<aut:process id="periodicBirth" handler="it.unipr.ce.dsg.deus.impl.process.TwoSpeedsPeriodicProcess">
		<aut:params>
			<aut:param name="firstPeriodArrival" value="0.5" />
			<aut:param name="secondPeriodArrival" value="10000000000000000" />
			<aut:param name="vtThreshold" value="5000" />	
		</aut:params>
		<aut:nodes>
			<aut:reference id="chordPeer" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth" />		
		</aut:events>
	</aut:process>
<!--	
	<aut:process id="periodicBirthForDeath" handler="it.unipr.ce.dsg.deus.impl.process.TwoSpeedsPeriodicProcess">
		<aut:params>
			<aut:param name="firstPeriodArrival" value="2000" />
			<aut:param name="secondPeriodArrival" value="10000000000000000" />
			<aut:param name="vtThreshold" value="4000" />	
		</aut:params>
		<aut:nodes>
			<aut:reference id="chordPeer" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth2" />		
		</aut:events>
	</aut:process>
-->	
	
	<aut:process id="poissonJoinPublish" handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="0" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="chordPeer" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="join" />
			<aut:reference id="publish" />
		</aut:events>
	</aut:process>

	<aut:process id="periodicStabilization" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="8" /> 
		</aut:params>
		<aut:events>
		    <aut:reference id="stabilize" />
		    <aut:reference id="fixFingers" />
		    <aut:reference id="refresh" />
		</aut:events>
	</aut:process>
	
	<aut:process id="periodicDiscovery" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="1000" /> 
		</aut:params>
		<aut:nodes>
			<aut:reference id="chordPeer" />
		</aut:nodes>
		<aut:events>
		    <aut:reference id="discovery" />
		</aut:events>
	</aut:process>
	
	<!-- ***cosi i nodi da disconnettere sono casuali *** -->
	
	<aut:process id="periodicDeath" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="700" /> 
		</aut:params>
		<aut:nodes>
			<aut:reference id="chordPeer" />
		</aut:nodes>
		<aut:events>
		    <aut:reference id="death" />
		</aut:events>
	</aut:process>
	
	<aut:process id="periodicDisconnection" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="700" /> 
		</aut:params>
		<aut:nodes>
			<aut:reference id="chordPeer" />
		</aut:nodes>
		<aut:events>
		    <aut:reference id="disconnection" />
		</aut:events>
	</aut:process>

	
	<aut:process id="periodicLog" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="999.99" /> 
		</aut:params>
		<aut:events>
		    <aut:reference id="logPopulationSize" />
		    <aut:reference id="logChordRingStats" />
		    <aut:reference id="logChordLoadBalance" />
		    <aut:reference id="logChordForPajek" />
		    <aut:reference id="logChordForNWB" />
		</aut:events>
	</aut:process>
	
	<aut:process id="time" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="25" /> 
		</aut:params>
		<aut:events>
		    <aut:reference id="time" />
		</aut:events>
	</aut:process>
	
		
	<!-- *** SIMULATION *** -->

	<aut:engine maxvt="1000" seed="123456789" keyspacesize="200000"> 
		<aut:logger level="ALL" />
		<aut:processes>
			<aut:reference id="periodicBirth" />
			<!--<aut:reference id="periodicBirthForDeath" />-->
			<aut:reference id="periodicLog" />
			<aut:reference id="periodicDeath" />
			<aut:reference id="periodicDisconnection" />
			<aut:reference id="time" />
		</aut:processes>
	</aut:engine>

</aut:automator>