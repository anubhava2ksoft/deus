<?xml version="1.0" encoding="UTF-8"?>
<aut:automator
	xmlns:aut="http://dsg.ce.unipr.it/software/deus/schema/automator"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://dsg.ce.unipr.it/software/deus/schema/automator automator.xsd ">


	<!-- *** EVENTS *** -->

	<aut:event id="nodeBirth" handler="NodeBirthEvent" />
	<!-- when scheduled, creates a new node -->

	<aut:event id="nodeDeath" handler="NodeDeathEvent"><!-- when scheduled, deletes a new node -->
		<aut:params>
			<aut:param name="meanDelay" value="0.1" /><!-- node death can be triggered by another event -->
		</aut:params>
	</aut:event>

	<aut:event id="baNodeSelection"
		handler="BarabasiAlbertNodeSelectionEvent">
<!-- when scheduled, selects m neighbours for the node -->
		<aut:params>
			<aut:param name="m" value="3" />
			<aut:param name="meanDelay" value="1" />
		</aut:params>
	</aut:event>

	<aut:event id="nodeDisconnection" handler="NodeDisconnectionEvent" />

	<aut:event id="kadBucketUpdate"
		handler="KademliaBucketUpdateEvent">
		<aut:params>
			<aut:param name="meanDelay" value="0.5" />
		</aut:params>
	</aut:event>

	<aut:event id="kadBucketUpdateMessaging"
		handler="KadBucketUpdateMessagingEvent">
		<aut:params>
			<aut:param name="meanDelay" value="0.2" />
		</aut:params>
		<aut:events>
			<aut:reference id="kadBucketUpdate" /><!-- event to be scheduled on addressee nodes -->
		</aut:events>
	</aut:event>

	<aut:event id="jobCreation" handler="JobCreator">
		<aut:params>
			<aut:param name="meanDuration" value="10" />
			<aut:param name="meanMemoryRequirements" value="100MB" />
			<aut:param name="meanProcessorUsage" value="0.3" />
		</aut:params>
	</aut:event>

	<aut:event id="jobDestinationSelection"
		handler="JobDestinationSelector" />

	<aut:event id="workloadExecution" handler="WorkloadExecutor" />

	<aut:event id="jobDistributionMessaging"
		handler="JobDistributionMessagingEvent">
		<aut:events>
			<aut:reference id="workloadExecution" /><!-- protocol to be scheduled on addressee nodes -->
		</aut:events>
	</aut:event>


	<!-- *** NODE SPECIES *** -->

	<aut:node id="supernode" handler="NodeSettingsDeclaration">
		<aut:params>
			<aut:param name="maxPeerview" value="100" />
			<aut:param name="downloadBandwidth" value="10Mbps" />
			<aut:param name="uploadBandwidth" value="2Mbps" />
			<aut:param name="CPU" value="2GHz" />
			<aut:param name="RAM" value="2000MB" />
		</aut:params>
	</aut:node>

	<!-- *** PROCESSES *** -->

	<aut:process id="growth" handler="PoissonProcess">
		<aut:params>
			<aut:param name="meanInterval" value="8" />
			<aut:param name="nodeSelectionMode" value="random" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="supernode" /><!-- this is to associate the process to a specific type of nodes -->
		</aut:nodes>
		<aut:events>
			<aut:reference id="nodeBirth" /><!-- solo questo evento è innescato secondo Poisson -->
			<aut:reference id="baNodeSelection" /><!-- questo evento è innescato da nodeBirth, e ha triggering time che dipende dal parametro meanDelay dell'evento) -->
			<aut:reference id="kadBucketUpdateMessaging" /><!-- innescato da baNodeSelection -->
		</aut:events>
	</aut:process>

	<aut:process id="nodeFailure" handler="PoissonProcess">
		<aut:params>
			<aut:param name="startTime" value="40000" />
			<aut:param name="meanInterval" value="4000" />
			<aut:param name="nodeSelectionMode" value="random" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="supernode" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="nodeDisconnection" /><!-- se fosse expected, il nodo dovrebbe mandare messaggi ai vicini -->
			<aut:reference id="nodeDeath" /><!-- questo evento è innescato da nodeDisconnection, e ha triggering time che dipende dal parametro meanDelay dell'evento) -->
		</aut:events>
	</aut:process>

	<aut:process id="loadBalancing" handler="DeterministicProcess">
		<aut:params>
			<aut:param name="startTime" value="20000" />
			<aut:param name="endTime" value="60000" />
			<aut:param name="interval" value="500" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="supernode" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="jobCreation" />
			<aut:reference id="jobDestinationSelection" />
			<aut:reference id="jobDistributionMessaging" />
		</aut:events>
	</aut:process>


	<!-- *** SIMULATION *** -->

	<aut:engine handler="DeterministicProcess" maxvt="100000"
		seed="123456789">
		<aut:processes>
			<aut:reference id="growth" />
			<aut:reference id="nodeFailure" />
			<aut:reference id="loadBalancing" />
		</aut:processes>
	</aut:engine>

</aut:automator>
