<?xml version="1.0" encoding="UTF-8"?>
<aut:automator
	xmlns:aut="http://dsg.ce.unipr.it/software/deus/schema/automator"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://dsg.ce.unipr.it/software/deus/schema/automator ../../schema/automator.xsd ">


	<!-- *** EVENTS *** -->

	<aut:event id="birth" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordBirthEvent" 
		schedulerListener="it.unipr.ce.dsg.deus.example.chordStreaming.ChordBirthSchedulerListener" >
	 	<aut:events><!-- events to be scheduled on created node -->
		    <aut:reference id="join" />
		    <aut:reference id="publish" />
		    <aut:reference id="stabilize" />
		    <aut:reference id="fixFingers" />	
		    <aut:reference id="discovery" />
		</aut:events>
	</aut:event>

	<aut:event id="birthServer" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordBirthEvent" 
		schedulerListener="it.unipr.ce.dsg.deus.example.chordStreaming.ChordBirthSchedulerListener" oneShot="true">
	 	<aut:events>
		    <aut:reference id="join" />
		    <aut:reference id="publishServer" />
		    <aut:reference id="stabilize" />
		    <aut:reference id="fixFingers" />
		</aut:events>
	</aut:event>

	<aut:event id="join" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordJoinEvent" oneShot="true" />

	<aut:event id="publish" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordPublishEvent">
	<aut:params>
			<aut:param name="hasSameAssociatedNode" value="true" />
		</aut:params>
	</aut:event>
	
	<aut:event id="publishServer" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordPublishEvent">
	<aut:params>
			<aut:param name="hasSameAssociatedNode" value="true" />
		</aut:params>
	</aut:event>
	
	<aut:event id="exchangeResource" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordDataExchangeEvent">
	<aut:params>
			<aut:param name="hasSameAssociatedNode" value="true" />
		</aut:params>
	</aut:event>
	
	<aut:event id="discovery" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordDiscoveryEvent">
	<aut:logger level="OFF" />
			<aut:params>
			<aut:param name="hasSameAssociatedNode" value="true" />
		</aut:params>
	</aut:event>
	
	<aut:event id="disconnection" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordDisconnectionEvent" >
	<aut:logger level="OFF" />
			<aut:params>
			<aut:param name="hasSameAssociatedNode" value="true" />
		</aut:params>
	</aut:event>

	<aut:event id="stabilize" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordStabilizeEvent">
		<aut:params>
			<aut:param name="hasSameAssociatedNode" value="true" />
		</aut:params>
	</aut:event>

	<aut:event id="fixFingers" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordFixFingersEvent">
		<aut:params>
			<aut:param name="hasSameAssociatedNode" value="true" />
		</aut:params>
	</aut:event>

	<aut:event id="findedResource" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordFindedResourceEvent" oneShot="true">
		<aut:logger level="INFO" />
		<aut:params>
			<aut:param name="hasSameAssociatedNode" value="true" />
		</aut:params>
	</aut:event>
	
	<aut:event id="playVideo" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordPlayVideoEvent" >
	<aut:logger level="INFO" />
	</aut:event>
	
	<aut:event id="propagationVideo" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordPropagationResourcesEvent" >
	<aut:logger level="INFO" />
	</aut:event>
	
	<aut:event id="updateVideoBuffer" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordUpdateVideoBufferEvent" >
	<aut:logger level="INFO" />
	</aut:event>
	
	<aut:event id="logChordSearching" handler="it.unipr.ce.dsg.deus.example.chordStreaming.LogChordSearchingEvent" />
	
	<aut:event id="logChordStats" handler="it.unipr.ce.dsg.deus.example.chordStreaming.LogChordStatsEvent" />
	
	<aut:event id="logChordFingerTable" handler="it.unipr.ce.dsg.deus.example.chordStreaming.LogChordFingerTable" />
	
	<aut:event id="logChordNodesResources" handler="it.unipr.ce.dsg.deus.example.chordStreaming.LogChordNodesResources" />
	
	<aut:event id="logChordServedPeers" handler="it.unipr.ce.dsg.deus.example.chordStreaming.LogChordServedPeers" />
	
	<aut:event id="logChordVideoBuffer" handler="it.unipr.ce.dsg.deus.example.chordStreaming.LogChordVideoBufferEvent" />
	
	<!-- *** NODE SPECIES *** -->

	<aut:node id="chordPeer" handler="it.unipr.ce.dsg.deus.example.chordStreaming.ChordPeer">
		<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="fingerTableSize" value="12" />
			<aut:param name="maxConnectionsFast" value="10" />
			<aut:param name="maxConnectionsMedium" value="6" />
			<aut:param name="maxConnectionsSlow" value="3" />
			<aut:param name="numPublishServer" value="1" />
			<aut:param name="bufferDimension" value="20" />
			<aut:param name="totalResources" value="5008" />
			<aut:param name="videoTitle1" value="KillBill" />
			<aut:param name="videoTitle2" value="Matrix" />
			<aut:param name="videoTitle3" value="Armaggeddon" />
		</aut:params>
	</aut:node>
	
	<!-- *** PROCESSES *** -->

	<aut:process id="poissonBirth" handler="it.unipr.ce.dsg.deus.impl.process.TwoSpeedsPeriodicProcess">
		<aut:params>
			<aut:param name="firstPeriodArrival" value="3" />
			<aut:param name="secondPeriodArrival" value="10000000000000000" />
			<aut:param name="vtThreshold" value="3600" />	
		</aut:params>
		<aut:nodes>
			<aut:reference id="chordPeer" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth" />		
		</aut:events>
	</aut:process>
	
	<aut:process id="poissonBirthForDisconnection" handler="it.unipr.ce.dsg.deus.impl.process.TwoSpeedsPeriodicProcess">
		<aut:params>
			<aut:param name="firstPeriodArrival" value="20" />
			<aut:param name="secondPeriodArrival" value="10000000000000000" />
			<aut:param name="vtThreshold" value="4000" />	
		</aut:params>
		<aut:nodes>
			<aut:reference id="chordPeer" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="disconnection" />		
		</aut:events>
	</aut:process>	

	<aut:process id="poissonBirthServer" handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="0" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="chordPeer" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="birthServer" />		
		</aut:events>
	</aut:process>
	
	<aut:process id="poissonJoinPublish" handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="0" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="chordPeer" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="join" />
		</aut:events>
	</aut:process>

	<aut:process id="periodicStabilization" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="5" /> 
		</aut:params>
		<aut:events>
		    <aut:reference id="stabilize" />
		    <aut:reference id="fixFingers" />
		    <aut:reference id="publish" />
		</aut:events>
	</aut:process>
	
	<aut:process id="publishVideo" handler="it.unipr.ce.dsg.deus.impl.process.TwoSpeedsPeriodicProcess">
		<aut:params>
			<aut:param name="firstPeriodArrival" value="5" />
			<aut:param name="secondPeriodArrival" value="10000000000000000" />
			<aut:param name="vtThreshold" value="25000" />
		</aut:params>
		<aut:events>
		    <aut:reference id="publishServer" />
		</aut:events>
	</aut:process>
	
	<aut:process id="periodicDiscovery" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="10" /> 
		</aut:params>
		<aut:nodes>
			<aut:reference id="chordPeer" />
		</aut:nodes>
		<aut:events>
		    <aut:reference id="discovery" />
		</aut:events>
	</aut:process>
	
	<aut:process id="periodicPlayVideo" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="25" /> 
		</aut:params>
		<aut:events>
		    <aut:reference id="playVideo" />
		</aut:events>
	</aut:process>
	
	<aut:process id="periodicPropagation" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="10" /> 
		</aut:params>
		<aut:events>
		    <aut:reference id="propagationVideo" />
		</aut:events>
	</aut:process>
	
	<aut:process id="updateVideo" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="10" /> 
		</aut:params>
		<aut:events>
		    <aut:reference id="updateVideoBuffer" />
		</aut:events>
	</aut:process>
	
	<aut:process id="periodicLog" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="24999" /> 
		</aut:params>
		<aut:events>
		    <aut:reference id="logChordSearching" />
		    <aut:reference id="logChordStats" />
		    <aut:reference id="logChordFingerTable" />
		    <aut:reference id="logChordNodesResources" />
		    <aut:reference id="logChordVideoBuffer" />
		    <aut:reference id="logChordServedPeers" />
		</aut:events>
	</aut:process>
	
		
	<!-- *** SIMULATION *** -->

	<aut:engine maxvt="25000" seed="123456789" keyspacesize="12000"> 
		<aut:logger level="INFO" />
		<aut:processes>
			<aut:reference id="poissonBirthServer" />
			<aut:reference id="poissonBirth" />
			<aut:reference id="periodicPlayVideo" />
			<aut:reference id="periodicPropagation" />
			<aut:reference id="poissonBirthForDisconnection" />
			<aut:reference id="periodicLog" />
		</aut:processes>
	</aut:engine>

</aut:automator>